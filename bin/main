#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';

use App\Helper\Updates;
use Symfony\Component\Console\Application;
use Symfony\Component\Finder\Finder;

if (Updates::check()) {

    //  @todo (Pablo - 2018-10-21) - Tool requires updating

} else {

    $oApp    = new Application();
    $oFinder = new Finder();

    //  Auto-load commands
    $sBasePath = __DIR__ . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR . 'src';
    $oFinder->files()->in($sBasePath . DIRECTORY_SEPARATOR . 'Command');

    foreach ($oFinder as $oFile) {
        $sCommand = $oFile->getPath() . DIRECTORY_SEPARATOR . $oFile->getBasename('.php');
        $sCommand = str_replace($sBasePath, 'App', $sCommand);
        $sCommand = str_replace(DIRECTORY_SEPARATOR, '\\', $sCommand);

        if ($sCommand !== 'App\\Command\\Base') {
            $oApp->add(new $sCommand());
        }
    }

    $oApp->setName('Shed Command Line Tool');
    $oApp->setVersion(Updates::getCurrentVersion());
    $oApp->run();
}
